<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<dom-module id="loading-graphic">
    <template>
        <style include = "shared-styles.html"> /* add to shared styles*/

         #loading-graph:fullscreen {

        }

        #loading-graph:-webkit-full-screen {

        }

        #loading-graph:-moz-full-screen {

        }

        #loading-graph:-ms-full-screen {
            
        }

        #loading-graph-container {

        }

        #loading-graph-header {

        }

        #loading-graph-header-span {
            
        }

        /*
            Terms by which to style nodes:

            popoto.graph.node.CountBox
            PAGE_SIZE
            TEXT_Y
            BACK_CIRCLE
            NODE_MAX_CHARS
            ELLIPSE_RX, ELLIPSE_RY

        NEED TO WORK OUT HOW TO DRAW IN THE WORLDCAT RECORDS!!!! 
        CAN ACCESS DATABASE BUT WHERE EXACTLY ARE RECORDS HELD???
*/
     </style>


        <app-local-storage-document key="data-search" data="{{searchparams}}"></app-local-storage-document>

             <div class="loading-graph-header">
                    <span class="loading-graph-header-span">Graph</span> search
                </div>

                <!-- -->
        
                <div class="ppt-container-graph">
                    <nav id = "popoto-taxonomy" class = ppt-taxo-nav> </nav>
                    
                    <div id="popoto-graph" class="ppt-div-graph">
                        <!-- Graph will be generated here-->
                        <!-- just want the graph to be integrated into the project, no other viewers -->
                        <span id = "loading-graph-desc"></span>
        
                    </div>
                </div>
            </div>
            
    </template>

    <script>
    </script>

    <script>
        popoto.rest.CYPHER_URL = "http://localhost:7474/db/data/transaction/commit"; //transactional endpoint

        // popoto.rest.AUTHORIZATION = "Basic " + btoa("neo4j:");


        const driver = neo4j.driver(popoto.rest.CYPHER_URL, neo4j.auth.basic(user, password));
        const session = driver.session();
        /*
        const transactionPromise = session.writeTransaction(tx => tx.run(
            CREATE(a: Edition) SET a.title = $title RETURN a.title + ", from node " + id(a), {
                title: ""
            }));
            */
        /*

                transactionPromise.then(result => {
                    session.close();
                    */

        const singleRecord = result.records[0];
        const title = singleRecord.get(0);

        console.log(title);
        session.close();

        driver.close();

        popoto.provider.nodeProviders = {
            "Edition": {
                "returnAttributes": ["ISBN", "title", "year"],
                "constraintAttributes": "ISBN",
                "autoExpandRelations": true

            },
            "Person": {
                "returnAttributes": ["fname", "lname"],
                "constraintAttribute": "lname",
                "autoExpandRelations": true // if set to true Person nodes will be automatically expanded in graph
            },
            "Place": {
                "returnAttributes": ["name"],
                "constraintAttribute": "title",
                "autoExpandRelations": true
            },

            "Publisher": {
                "returnAttributes": ["name"],
                "constraintAttribute": "name",
                "autoExpandRelations": true
            }
        };

        /*Event Listener*/

        popoto.result.onTotalResultCount(function(count) {
            document.getElementById("dhc-graph").innerHTML = "(" + count + ")";
        });


        class dhcGraph extends Polymer.Element { /*may not even need this*/
                static get is() {
                    return 'loadingGraph'
                };

                static get properties() {
                    return {
                        searchParams: {
                            type: Object,
                            notify: true,
                            value: {}
                        }

                    }
                }

            }
            // window.customElements.define(loadingGraphic.is, loadingGraphic);

        popoto.start("Edition");
    </script>


</dom-module>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<dom-module id="loading-graphic">
    <template>
        <style> /* add to shared styles*/
            
        #popoto-graph:fullscreen {
            
        }
        
        #popoto-graph:-webkit-full-screen {
           
        }
        
        #popoto-graph:-moz-full-screen {
           
        }
        
        #popoto-graph:-ms-fullscreen {
          
        }

        /*
            Terms by which to style nodes:

            popoto.graph.node.CountBox
            PAGE_SIZE
            TEXT_Y
            BACK_CIRCLE
            NODE_MAX_CHARS
            ELLIPSE_RX, ELLIPSE_RY

        NEED TO WORK OUT HOW TO DRAW IN THE WORLDCAT RECORDS!!!! 
        CAN ACCESS DATABASE BUT WHERE EXACTLY ARE RECORDS HELD???

        

        */
    

        </style>


        <app-local-storage-document key="data-search" data="{{searchparams}}"></app-local-storage-document>

            <!-- need to parse data -->

            <div class="graphic-header">
                    <span class="graphic-header-span">Graph</span> search
                </div>
        
                <div class="graph-container">
                    
                    <div id="dhc-loading-graph" class="dhc-loading-graph">
                        <!-- Graph will be generated here-->
                        <!-- just want the graph to be integrated into the project, no other viewers -->
                        <span id = "dhc-span-graph"></span>
        
                    </div>
                </div>
        
                <div id="popoto-cypher" class="ppt-container-cypher">
                    <!-- parse in input values here -->

                </div>
        
                <!-- do not need any kind of result count--> 
                
            
            
    </template>

    <script>
        popoto.provider.nodeProviders = {
            "Edition": {
                "returnAttributes": ["ISBN", "title", "year"],
                "constraintAttributes": "ISBN",
                "autoExpandRelations": true

            },
            "Person": {
                "returnAttributes": ["fname", "lname"],
                "constraintAttribute": "lname",
                "autoExpandRelations": true // if set to true Person nodes will be automatically expanded in graph
            },
            "Place": {
                "returnAttributes": ["name"],
                "constraintAttribute": "title",
                "autoExpandRelations": true
            },

            "Publisher": {
                "returnAttributes": ["name"],
                "constraintAttribute": "name",
                "autoExpandRelations": true
            }
        };

        /*Event Listener*/

        popoto.result.onTotalResultCount(function(count) {
            document.getElementById("dhc-graph").innerHTML = "(" + count + ")";
        });


        class loadingGraphic extends Polymer.Element {
            static get is() {
                return 'loading-graphic'
            };

            static get properties() {
                return {
                    searchParams: {
                        type: Object,
                        notify: true,
                        value: {}
                    }

                }
            }

        }
        window.customElements.define(loadingGraphic.is, loadingGraphic);
    </script>


</dom-module>



<!---------------------->
<!-- Required scripts -->

<!-- Jquery is only used in popoto.js to send ajax POST request on Neo4j REST API -->
<!-- This dependency will probably be rem -->

<script src="js/d3.v3.min.js" charset="utf-8"></script>
<script src="js/popoto.min.js" charset="utf-8"></script>

<script>
    /**
     * URL used to access Neo4j REST API to execute queries.
     * Update this parameter to your running server instance.
     *
     * For more information on Neo4J REST API the documentation is available here: http://neo4j.com/docs/stable/rest-api-cypher.html
     */
    popoto.rest.CYPHER_URL = "http://localhost:7474/db/data/transaction/commit";

    /**
     * Add this authorization property if your Neo4j server uses basic HTTP authentication.
     * The value of this property must be "Basic <payload>", where "payload" is a base64 encoded string of "username:password".
     *
     * "btoa" is a JavaScript function that can be used to encode the user and password value in base64 but it is recommended to directly use the Base64 value.
     *
     *  For example Base64 encoded value of "neo4j:password" is "bmVvNGo6cGFzc3dvcmQ="
     */
    popoto.rest.AUTHORIZATION = "Basic " + btoa("neo4j:password");

    /**
     * Define the Label provider you need for your application.
     * This configuration is mandatory and should contain at least all the labels you could find in your graph model.
     *
     * In this version only nodes with a label are supported.
     *
     * By default If no attributes are specified Neo4j internal ID will be used.
     * These label provider configuration can be used to customize the node display in the graph.
     * See www.popotojs.com or example for more details on available configuration options.
     */


    /**
     * Here a listener is used to retrieve the total results count and update the page accordingly.
     * This listener will be called on every graph modification.
     */
    popoto.result.onTotalResultCount(function(count) {
        document.getElementById("result-total-count").innerHTML = "(" + count + ")";
    });

    /**
     * The number of results returned can be changed with the following parameter.
     * Default value is 100.
     *
     * Note that in this current version no pagination mechanism is available in displayed results
     */
    //popoto.query.RESULTS_PAGE_SIZE = 100;


    /**
     * For this version, popoto.js has been generated with debug traces you can activate with the following properties:
     * The value can be one in DEBUG, INFO, WARN, ERROR, NONE.
     *
     * With INFO level all the executed cypher query can be seen in the navigator console.
     * Default is NONE
     */
    //popoto.logger.LEVEL = popoto.logger.LogLevels.INFO;

    /**
     * Start popoto.js generation.
     * The function requires the label to use as root element in the graph.
     */
    popoto.start("Person");
</script>
</body>

</html>
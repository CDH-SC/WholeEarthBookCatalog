<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<dom-module id="loading-graphic">
    <template>
        <style> /* add to shared styles*/

        /*
            Terms by which to style nodes:

            popoto.graph.node.CountBox
            PAGE_SIZE
            TEXT_Y
            BACK_CIRCLE
            NODE_MAX_CHARS
            ELLIPSE_RX, ELLIPSE_RY

        NEED TO WORK OUT HOW TO DRAW IN THE WORLDCAT RECORDS!!!! 
        CAN ACCESS DATABASE BUT WHERE EXACTLY ARE RECORDS HELD???
*/
     </style>


        <app-local-storage-document key="data-search" data="{{searchparams}}"></app-local-storage-document>

            

            <div class="graphic-header">
                    <span class="graphic-header-span">Graph</span> search
                </div>
        
                <div class="graph-container">
                    
                    <div id="dhc-loading-graph" class="dhc-loading-graph">
                        <!-- Graph will be generated here-->
                        <!-- just want the graph to be integrated into the project, no other viewers -->
                        <span id = "dhc-span-graph"></span>
        
                    </div>
                </div>
        
                <div id="popoto-cypher" class="ppt-container-cypher">
                    <!-- parse in input values here -->

                </div>
            
    </template>

    <script>
        popoto.rest.CYPHER_URL = "http://localhost:7474/db/data/transaction/commit";

        popoto.rest.AUTHORIZATION = "Basic " + btoa("neo4j:");

        popoto.provider.nodeProviders = {
            "Edition": {
                "returnAttributes": ["ISBN", "title", "year"],
                "constraintAttributes": "ISBN",
                "autoExpandRelations": true

            },
            "Person": {
                "returnAttributes": ["fname", "lname"],
                "constraintAttribute": "lname",
                "autoExpandRelations": true // if set to true Person nodes will be automatically expanded in graph
            },
            "Place": {
                "returnAttributes": ["name"],
                "constraintAttribute": "title",
                "autoExpandRelations": true
            },

            "Publisher": {
                "returnAttributes": ["name"],
                "constraintAttribute": "name",
                "autoExpandRelations": true
            }
        };

        /*Event Listener*/

        popoto.result.onTotalResultCount(function(count) {
            document.getElementById("dhc-graph").innerHTML = "(" + count + ")";
        });


        class dhcGraph extends Polymer.Element { /*may not even need this*/
            static get is() {
                return 'loadingGraph'
            };

            static get properties() {
                return {
                    searchParams: {
                        type: Object,
                        notify: true,
                        value: {}
                    }

                }
            }

        }
        window.customElements.define(loadingGraphic.is, loadingGraphic);

        popoto.start("dhc-graph");
    </script>


</dom-module>
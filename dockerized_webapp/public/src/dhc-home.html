<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="frag-footer.html">
<link rel="import" href="frag-header.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html">


<dom-module id="dhc-home">
    <template>
        <style include="shared-styles">
            paper-input {
                margin: 0;
            }
            paper-button.advanced-search-button {
                font-size: 18px;
                color: #2d9CDB;
                text-decoration: underline;
                padding: 0;
                margin: 0;
                box-shadow: none;
                height: 18px;
            }

            .align-advanced-item {
                width: 100%;
                display: flex;
                flex-direction: row;
                justify-content: flex-end;
            }

            h1 {
                margin: 0;
                text-align: center;
                font-size: 96px;
                font-weight: lighter;
            }

            .book-view {
                font-size: 36px;
                font-style: italic;
                margin-top: 50px;
                height: 315px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bolder;
                width: 100%;
            }

            #recommendations {
                display: flex;
                flex-basis: auto;
                flex-grow: 1;
                justify-content: center;
                align-items: center;
                text-align: center;
                max-width: 800px;
                height: 315px;
                background-color: rgba(0,0,0, 0.6);
                z-index: 10;
                color: whitesmoke;
            }

            @media screen and (max-width: 1050px) {
            
            }

            @media screen and (max-width: 800px) {
                .book-view {
                    display: none;
                }
            }

            @media screen and (max-height: 800px) {
                .book-view {
                    display: none;
                }
            }

            #book-recommends {
                display: flex;
                flex-basis: auto;
                flex-grow: 1;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                max-width: 800px;
                position: absolute;
                z-index: 1;
            }

            #book-recommends > iron-icon {
                height: 50px;
                width: 50px;
            }

            .book-rec {
                width: 150px;
                height: 250px;
                padding-left: 15px;
                padding-right: 15px;
            }

            .book-rec > img {
                width: 150px; 
                height: 100%;
            }

            paper-button.chev-cir {
                padding: 0;
                margin: 0;
                min-width: unset;
                height: 50px;
                width: 50px;
                border-radius: 100px;
                font-size: 18px;
                box-sizing: border-box;
                margin-right: 10px;
                margin-left: 10px;
            }
            
            a > paper-button {
                color: #333333;
            }

            a:visited > paper-button {
                color: #333333;
            }

            .chev-button {
                max-height:50px;
                max-width: 50px;
                min-width: 50px;
                min-height: 50px;
                border: 3px solid black;
                border-radius: 30px;
            }

            .inner-container {
                width: 60%;
                max-width: 800px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

        </style>

<!--The actual html goes in here-->
        <app-header>
            <frag-header user="{{user}}"></frag-header>
            <div class="container">
                <div class="inner-container">
                    <h1 id="title-center">DHC</h1>
                    <paper-input class="large-keyword-search" placeholder="Keywords">
                            <iron-icon icon="arrow-forward" slot="suffix"></iron-icon>
                    </paper-input>
                    <div class="align-advanced-item">
                        <paper-button class="advanced-search-button">Advanced</paper-button>
                    </div>

                    <div class="book-view">
                        <template is="dom-if" if="{{!inSession}}">
                            <!-- set to true to show for now -->
                            <div id="recommendations">
                                Sign in for Recommendations
                            </div>
                        </template>

                        <div id="book-recommends">
                            <!-- placeholders -->
                            <paper-button on-click="_set_image_b" class="chev-cir"><iron-icon class="chev-button" icon="chevron-left"></iron-icon></paper-button>
                            <template is="dom-repeat" items=[[current_display]]>
                                <div class="book-rec">
                                    <img width="150px" src="{{item}}"></img>
                               </div>
                            </template>
                            <paper-button on-click="_set_image_f" class="chev-cir"><iron-icon class="chev-button" icon="chevron-right"></iron-icon></paper-button>
                        </div>
                    </div>
                </div>
                <frag-footer></frag-footer>
            </div>
        </app-header>
    
    </template>
    <script>
    class dhcHome extends Polymer.Element {
        static get is() {
            return 'dhc-home';
        }

        static get properties() {
            return {
                user: {
                    type: Object,
                    notify: true,
                    observer: "_update_dom_session"
                },
                // Temporary kind of 
                book_rec_covers: {
                    type: Array,
                    value: ['../images/clockwork_small.jpg', '../images/animators-cover.jpg', '../images/creative_bookcover.png', '../images/im-cover-150px.jpg'],
                },
                book_rec_size: {
                    type: Number,
                    value: 3,
                    observer: '_book_rec_size_changed'
                },
                current_display: {
                    type: Array
                },
                inSession: {
                    type: Boolean
                }
            };
        }


        constructor() {
            super();
            this._windowResize = this._resize.bind(this);
          }

        ready() {
            // needs more complexity
            super.ready();
            this._resize();
            this.current_display = [];
            console.log("REC", this.book_rec_size);
            for (var i = 0; i < this.book_rec_size; i++) {
                this.push('current_display', this.book_rec_covers[i]);
            }

            this._update_dom_session();
         }

        connectedCallback() {
            super.connectedCallback();
            window.addEventListener('resize', this._windowResize);
        }

        _update_dom_session() {
            if(this.user === null || this.user === undefined || this.user === {}) {
                this.inSession = false;
            }
            else {
                console.log("WHAT", this.user);
                this.inSession = true;
            }
        }

        _book_rec_size_changed(oldVal, newVal) {
            if(oldVal !== newVal && this.current_display) {
                if(oldVal < newVal) {
                    this.pop('current_display');
                }
                else {
                    var add_index = this.book_rec_covers.indexOf(this.current_display[this.current_display.length - 1]) + 1;
                    if(add_index >= this.book_rec_covers.length) {
                        add_index = 0;
                    }
                    this.push('current_display', this.book_rec_covers[add_index]);
                }
            }
        }

        _set_image_f() {
            var ind = this.book_rec_covers.indexOf(this.current_display[this.current_display.length - 1]) + 1;

            if (ind >= this.book_rec_covers.length) {
                ind = 0;
            }

            this.push('current_display', this.book_rec_covers[ind]);
            this.shift('current_display');
        }

        _set_image_b() {
            var ind = this.book_rec_covers.indexOf(this.current_display[0]) - 1;

            if (ind < 0) {
                ind = this.book_rec_covers.length - 1;
            }

            this.pop('current_display');
            this.unshift('current_display', this.book_rec_covers[ind]);
        }

        _resize() {
            if (window.innerWidth < 1050 && window.innerWidth >= 800) {
                this.book_rec_size = 1;
            }
            else if(window.innerWidth >= 1050 && window.innerWidth <= 1300) {
                this.book_rec_size = 2;
            }
            else if(window.innerWidth > 1300) {
                this.book_rec_size = 3;
            }
            else {
                this.book_rec_size = 0;
            }
        }
    }
        window.customElements.define(dhcHome.is, dhcHome);
    </script>
</dom-module>

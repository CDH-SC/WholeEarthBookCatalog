<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="../bower_components/app-route/app-location.html"><link rel="import" href="crypto-import.html"><link rel="import" href="frag-header.html"><link rel="import" href="frag-footer.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="dhc-create-account"><template><style include="shared-styles iron-flex iron-flex-alignment">.container{@apply --layout-horizontal;}#login-box{min-height:600px;min-width:500px;box-shadow:0px 4px 4px  rgba(0, 0, 0, 0.25);}#inner-flex{padding:20px;}</style><app-location route="{{route}}"></app-location><div class="container"><div id="login-box"><div id="inner-flex"><h1>DHC</h1><h2>Login</h2><paper-input placeholder="Username" value="{{username}}"></paper-input><paper-input error-message="invalid" placeholder="Password" type="password" value="{{password}}"></paper-input><paper-input placeholder="Confirm Password" type="password" value="{{password_confirm}}"></paper-input><paper-button on-click="_validate">Login</paper-button><template is="dom-if" if="[[!valid]]"><p>{{errorMessage}}</p></template><iron-ajax method="POST" id="addAj" url="/api/add_user" handle-as="json" last-response="{{mySession}}" on-response="_handleResponse" content-type="application/json" debounce-duration="300"></iron-ajax></div></div></div><frag-footer></frag-footer></template><script>class dhcCreateAccount extends Polymer.Element{static get is(){return"dhc-create-account"}static get properties(){return{route:{type:Object,notify:!0},page:{type:String,notify:!0},valid:Boolean,errorMessage:String}}_validate(){!this.username||""==this.username||3>=this.username.length?(this.set("errorMessage","Username not long enough"),this.valid=!1):this.password&&this.password_confirm?5>=this.password.length?(this.set("errorMessage","Password not long enough"),this.valid=!1):this.password===this.password_confirm?this._post_new_user():(this.set("errorMessage","passwords don't match"),this.valid=!1):(this.set("errorMessage","Passwords not equal"),this.valid=!1)}_post_new_user(){var a={username:this.username,password:CryptoJS.SHA256(CryptoJS.SHA256(this.password).toString()+CryptoJS.SHA256(this.username).toString()).toString()};this.$.addAj.body=a,this.$.addAj.generateRequest()}_handleResponse(a){a.detail.response&&(a.detail.response.insertedIds?(console.log(a.detail.response),this.dispatchEvent(new CustomEvent("update-user",{bubbles:!0,composed:!0,detail:{user:a.detail.response}})),this.valid=!0,this.set("route.path","/home")):a.detail.response.Error?"invaild data format"===a.detail.response.Error?(this.set("errorMessage","invalid data format"),this.valid=!1):(this.set("errorMessage","Username already exists"),this.valid=!1):this.set("errorMessage","invalid data format"))}}window.customElements.define(dhcCreateAccount.is,dhcCreateAccount);</script></dom-module></body></html>
<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-route/app-location.html"><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html"></head><body><dom-module id="frag-advanced-search"><template><style>#dialog{width:60%;}.col-inputs{display:flex;flex-direction:row;justify-content:space-around;}.input-adv{width:50rem;padding-right:2rem;padding-left:2rem;}.remove{background-color:red;color:white;}.add{background-color:green;color:white;}.search-submit{background-color:blue;color:white;}paper-dialog paper-dialog-scrollable{--paper-dialog-scrollable:{box-sizing:border-box;width:80%;height:640px;};}</style><iron-ajax method="POST" id="saveq" url="/api/update_saved_content" handle-as="json" on-response="_handleRecentSearch" content-type="application/json" debounce-duration="300"></iron-ajax><paper-dialog id="dialog"><h2>Advanced Search</h2><paper-dialog-scrollable><template is="dom-repeat" items="[[numFieldsArray]]"><div class="col-inputs"><paper-dropdown-menu label="search type" on-value-changed="_update_num_fields" data-args="{{item}}"><paper-listbox slot="dropdown-content" selected="{{item.searchTypeID}}"><paper-item></paper-item><template is="dom-repeat" items="[[avaliableChoices]]" as="choice"><paper-item>{{choice.field}}</paper-item></template></paper-listbox></paper-dropdown-menu><paper-button class="remove" on-click="_remove" remove-item="{{item}}" disabled="{{item.first}}">Remove</paper-button></div><template is="dom-if" if="{{_isAuthor(item.searchType)}}"><paper-input label="first name" value="{{item.value.fname}}"></paper-input><paper-input label="last name" value="{{item.value.lname}}"></paper-input></template><template is="dom-if" if="{{_isPub(item.searchType)}}"><paper-input label="name" value="{{item.value.name}}"></paper-input></template><template is="dom-if" if="{{_isEdition(item.searchType)}}"><paper-input label="name" value="{{item.value.name}}"></paper-input><paper-input label="year" value="{{item.value.year}}"></paper-input></template><template is="dom-if" if="{{_isLocation(item.searchType)}}"><paper-input label="Location" placeholder="Location" value="{{item.value.place}}"></paper-input></template><template is="dom-if" if="{{_isDegree(item.searchType)}}"><paper-dropdown-menu label="search type"><paper-listbox slot="dropdown-content" selected="{{item.value.degree}}"><paper-item></paper-item><paper-item>1</paper-item><paper-item>2</paper-item><paper-item>3</paper-item><paper-item>4</paper-item><paper-item>5</paper-item><paper-item>6</paper-item><paper-item>7</paper-item></paper-listbox></paper-dropdown-menu></template></template><template is="dom-if" if="{{_invalidSearch}}"><p>Your search was invalid. Check over your fields and make sure everything has a title and author</p></template><paper-button class="add" on-click="_increment_num_fields" disabled="{{addMoreDisabled}}">Add Field</paper-button><paper-button class="search-submit" on-click="_goto_search">Search</paper-button></paper-dialog-scrollable></paper-dialog></template><script>class fragAdvancedSearch extends Polymer.Element{static get is(){return"frag-advanced-search"}static get properties(){return{user:{type:Object,notify:!0},numInputs:Number,addMoreDisabled:Boolean,numFieldsArray:{type:Array,value:[{id:0,searchTypeID:-1,searchType:"",value:{}}]},avaliableChoices:{type:Array,value:[{field:"author",subFields:[{value:"first name",type:"String"},{value:"last name",type:"String"}]},{field:"publisher",subFields:[{value:"name",type:"String"}]},{field:"edition",subFields:[{value:"title",type:"String"},{value:"year",type:"Number"}]},{field:"location",subFields:[{value:"name",type:"String"}]},{field:"degree",subFields:[{value:"degree",type:"Dropdown"}]}]},_highestIDUsed:{type:Number,value:0},_invalidSearch:{type:Boolean,value:!1},_degreeLimit:{type:Number,value:7},_inputLimit:{type:Number,value:10}}}constructor(){super()}ready(){super.ready()}_getItems(a){var b=a.searchTypeID-1;return this.avaliableChoices[b].subFields}_isAuthor(a){return"author"===a}_isDegree(a){return"degree"===a}_isLocation(a){return"location"===a}_isPub(a){return"publisher"===a}_isEdition(a){return"edition"===a}_checkSearchType(a){return!("author"!==a)}_increment_num_fields(){this._highestIDUsed+=1,this.push("numFieldsArray",{id:this._highestIDUsed,value:"",searchTypeID:-1,searchType:"",value:{}}),this.numFieldsArray.length>=this._inputLimit&&this.set("addMoreDisabled",!0)}_update_num_fields(a){var b=a.path[0].dataArgs;this.numFieldsArray.some(function(c,d){if(c.id===b.id)return void this.set("numFieldsArray."+d+".searchType",a.detail.value)}.bind(this))}_remove(a){this.numFieldsArray.some(function(b,c){if(b.id===a.path[0].removeItem.id)return void this.splice("numFieldsArray",c,1)}.bind(this)),this.numFieldsArray.length<this._inputLimit&&this.set("addMoreDisabled",!1)}_validate(){if(0>=this.numFieldsArray.length)this.set("_invalidSearch",!0),this._bindTimeout();else if(0<this.numFieldsArray.length){for(var a,b=0;b<this.numFieldsArray.length;b++)""===this.numFieldsArray[b].searchType&&""!==this.numFieldsArray[b].value&&(this.set("_invalidSearch",!0),this._bindTimeout()),""!==this.numFieldsArray[b].searchType&&""!==this.numFieldsArray[b].value&&(a=!0);a?this.set("_invalidSearch",!1):(this.set("_invalidSearch",!0),this._bindTimeout())}else this.set("_invalidSearch",!1)}_bindTimeout(){setTimeout(function(){this.set("_invalidSearch",!1)}.bind(this),5e3)}_unsetInvalid(){this.set("_invalidSearch",!1)}_goto_search(){if(console.log(this.numFieldsArray),this._validate(),!this._invalidSearch){var a={advanced:!0,basic_query:"",terms:this.numFieldsArray,limit:25};this.$.saveq.body={_id:this.user.id,keyword:"recent_searches",content:a},this.$.saveq.generateRequest(),this.dispatchEvent(new CustomEvent("update-search",{bubbles:!0,composed:!0,detail:"Bach"})),this.set("route.path","/book-results/Bach")}}_handleRecentSearch(){console.log("successfull")}}window.customElements.define(fragAdvancedSearch.is,fragAdvancedSearch);</script></dom-module></body></html>
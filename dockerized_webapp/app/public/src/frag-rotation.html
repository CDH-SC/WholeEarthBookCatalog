<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">

<dom-module id="frag-rotation">
    <template>
        <style>

            #book-recommends {
                display: flex;
                flex-basis: auto;
                flex-grow: 1;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                max-width: 800px;
            }

            #book-recommends > iron-icon {
                height: 50px;
                width: 50px;
            }



            paper-button.chev-cir {
                padding: 0;
                margin: 0;
                min-width: unset;
                height: 50px;
                width: 50px;
                border-radius: 100px;
                font-size: 18px;
                box-sizing: border-box;
                margin-right: 10px;
                margin-left: 10px;
                color: #333333;
            }

            .chev-button {
                max-height:40px;
                max-width: 40px;
                min-width: 40px;
                min-height: 40px;
                border: 3px solid #333333;
                box-shadow: 0px 5px 5px rgba(0,0,0,0.25);
                border-radius: 30px;
            }

            .book-wrapper {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .rec-book {
                box-shadow: 0px 4px 4px rgba(0,0,0,0.2);
            }

            .book-rec {
                height: 95%;
                padding-left: 15px;
                padding-right: 15px;
            }

            img {
                width: auto;
                max-width: 150px;
            }
        </style>

        <div id="book-recommends">
            <paper-button on-click="_set_image_b" class="chev-cir"><iron-icon class="chev-button" icon="chevron-left"></iron-icon></paper-button>
            <div class="book-wrapper">
                <template is="dom-repeat" items="[[current_display]]">
                    <div class="book-rec">
                        <img class="rec-book" src="{{item}}"></img>
                    </div>
                </template>
            </div>
            <paper-button on-click="_set_image_f" class="chev-cir"><iron-icon class="chev-button" icon="chevron-right"></iron-icon></paper-button>
        </div>
    </template>
    <script>
        class fragRotation extends Polymer.Element {
            static get is() {
                return 'frag-rotation';
            }

            static get properties() {
                return {
                    book_rec_covers: {
                        type: Array,
                        value: ['../images/no_cover_150_248.png', '../images/no_cover_150_248.png', '../images/no_cover_150_248.png', '../images/no_cover_150_248.png'],
                    },
                    book_rec_size: {
                        type: Number,
                        value: 3,
                        observer: '_book_rec_size_changed'
                    },
                    current_display: {
                        type: Array
                    },
                }
            }

            constructor() {
                super();
                this._windowResize = this._resize.bind(this);
            }

            ready() {
                super.ready();
                this._resize();
                this.current_display = [];
                for (var i = 0; i < this.book_rec_size; i++) {
                    this.push('current_display', this.book_rec_covers[i]);
                }
            }

            connectedCallback() {
                super.connectedCallback();
                window.addEventListener('resize', this._windowResize);
            }

            _book_rec_size_changed(oldVal, newVal) {
                if(oldVal !== newVal && this.current_display) {
                    if(oldVal < newVal) {
                        this.pop('current_display');
                    }
                    else {
                        var add_index = this.book_rec_covers.indexOf(this.current_display[this.current_display.length - 1]) + 1;
                        if(add_index >= this.book_rec_covers.length) {
                            add_index = 0;
                        }
                        this.push('current_display', this.book_rec_covers[add_index]);
                    }
                }
            }

            _set_image_f() {
                var ind = this.book_rec_covers.indexOf(this.current_display[this.current_display.length - 1]) + 1;

                if (ind >= this.book_rec_covers.length) {
                    ind = 0;
                }

                this.push('current_display', this.book_rec_covers[ind]);
                this.shift('current_display');
            }

            _set_image_b() {
                var ind = this.book_rec_covers.indexOf(this.current_display[0]) - 1;

                if (ind < 0) {
                    ind = this.book_rec_covers.length - 1;
                }

                this.pop('current_display');
                this.unshift('current_display', this.book_rec_covers[ind]);
            }

            _resize() {
                if (window.innerWidth < 1050 && window.innerWidth >= 800) {
                    this.book_rec_size = 1;
                }
                else if(window.innerWidth >= 1050 && window.innerWidth <= 1300) {
                    this.book_rec_size = 2;
                }
                else if(window.innerWidth > 1300) {
                    this.book_rec_size = 3;
                }
                else {
                    this.book_rec_size = 0;
                }
            }
        }
        window.customElements.define(fragRotation.is, fragRotation);
    </script>
</dom-module>
